<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">
    <title>Forum Webpage</title>

    <style>
        @import url(forumStyles.css);
    </style>
</head>

<body>
    <header class="fixed-header">
        <!-- nav and ul elements used for formatting organization -->
        <nav>
            <div class="link-buttons mt-3">
                <a href="index.html" class="btn btn-primary mr-2 mb-2">Home</a>
                <a href="forum.html" class="btn btn-primary mr-2 mb-2">Forum</a>
                <a href="meetup.html" class="btn btn-primary mr-2 mb-2">Meetup Forum</a>
                <a href="videopage.html" class="btn btn-primary mr-2 mb-2">Video Library</a>
                <a href="dashboard.html" class="btn btn-primary mr-2 mb-2">Progress Dashboard</a>
                <a href="article_library.html" class="btn btn-primary mr-2 mb-2">Article Library</a>
                <a href="DailyInteractive/dailyInteractive.html" class="btn btn-primary mr-2 mb-2">Daily Interactive</a>
                <a href="relaxation-sounds.html" class="btn btn-primary mr-2 mb-2">Relaxation Sounds Library</a>
                <a href="MeditationSession.html" class="btn btn-primary mr-2 mb-2">Meditation Sessions</a>
                <a href="timersPage.html" class="btn btn-primary mr-2 mb-2">Timers</a>
            </div>
        </nav>
    </header>

    <!-- Login button -->
    <div class="user-button-container" style="text-align: right; padding-right: 20px; padding-top: 80px;">
        <button id="leftButton" class="btn btn-primary btn-lg">Sign Up</button>
        <button id="rightButton" class="btn btn-secondary btn-lg">Login</button>
    </div>

    <h1 class="logo-container"><img src="MeditationLogo.PNG" alt="logo"></h1>

    <h1>Meditation+ Forum</h1>

    <div class="post-form-container">
        <h2>Create a New Post</h2>
        <form id="postForm" action="/forum" method="POST">            
            <label for="postTitle">Title:</label>
            <input type="text" id="postTitle" name="postTitle" required>
    
            <label for="postContent">Content:</label>
            <textarea id="postContent" name="postContent" required></textarea>
    
            <button type="submit">Post</button>
        </form>
    </div>

    <!-- Section for displaying forum posts -->
    <h2>Forum Posts</h2>

    <section id="forum-posts">

    </section>

    <footer>
        <p><small>This page and all properties owned by Meditation+&copy;</small></p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="forumFormatting.js"></script>

    <!-- Importing forum.js script -->
    <script src="./functions/forum.js"></script>
    <!-- Script for retrieving and displaying posts from KV namespace -->
    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            try {
                // Call the getAllPosts function to retrieve posts
                const allPosts = await getAllPosts({});

                // Log the retrieved JSON data to the console
                console.log('Retrieved JSON data:', allPosts);
    
                // Check if the response is successful (status code 200)
                if (!response.ok) {
                    throw new Error('Failed to fetch posts');
                }

                // Log the retrieved JSON data to the console
                console.log('Retrieved JSON data:', allPosts);
                
                // Get the section where forum posts will be displayed
                const forumPostsSection = document.getElementById('forum-posts');
                
                // Iterate over each post and display type 1 posts only
                allPosts.forEach(post => {
                    if (post.type === 1) {
                        const postElement = document.createElement('div');
                        postElement.classList.add('post');
        
                        // Create HTML structure for each type 1 post
                        postElement.innerHTML = `
                            <h3>${post.title}</h3>
                            <p>${post.content}</p>
                            <p>Type: Regular</p>
                            <hr>
                        `;
        
                        // Append the post element to the forum posts section
                        forumPostsSection.appendChild(postElement);
                    }
                });
            } catch (error) {
                // Handle the error and display error message to user
                console.error('Error fetching posts:', error.message);
            }
        });
    </script>
</body>

</html>